SELECT * From CAMS_UserRoles_View

--SELECT * FROM CAMS_MenuList_View WHERE (moduleorder <= 14) order by moduleorder, menulevel, parentorder, itemOrder

SELECT * FROM User_Roles


create table #TmpChainDec(
	RawStr varchar(10),
	DescStr varchar(50),
	IDStr int
)
declare @StrChain varchar(max)
declare @lstcharind int
declare @lendcharind int

set @StrChain='1!1,3!1,23!1,288!1,340!0,526!0,24!0,38!0,26!1,27!1,281!0,19!0,649!0,474!0,575!0,606!0,647!0,2!2,251!0,7!1,140!0,285!0,11!1,33!1,14!0,13!0,35!0,36!0,37!0,274!0,387!0,16!1,20!1,18!0,17!0,389!0,574!0,607!0,641!0,5!0,43!0,44!0,45!0,46!0,338!1,339!1,341!0,342!0,25!0,299!0,300!0,10!0,193!1,194!1,195!0,196!0,197!0,290!1,213!1,212!0,214!1,472!0,590!0,297!1,201!0,202!1,198!1,200!1,204!0,206!1,207!1,248!0,104!2,624!0,208!1,209!1,210!0,211!1,215!1,216!1,89!0,217!0,90!0,295!0,296!0,500!0,430!0,220!0,221!0,222!0,223!1,224!1,225!0,231!1,227!1,226!0,374!1,228!1,229!0,516!0,230!1,78!1,236!1,237!1,238!1,255!0,239!1,245!1,246!1,569!0,568!1,307!1,308!1,247!1,250!0,519!1,451!0,487!0,488!0,489!0,490!0,491!0,492!0,493!0,494!0,495!0,496!0,498!0,511!0,512!0,521!0,522!0,532!0,591!0,592!0,621!0,622!0,623!0,6!1,47!0,301!0,286!0,49!0,50!0,51!0,52!0,55!0,56!0,57!0,58!0,59!0,60!0,61!0,54!0,62!0,63!0,82!0,83!0,101!0,64!1,53!1,80!0,77!0,68!0,93!0,431!0,638!0,639!0,432!0,462!0,463!0,464!0,465!0,602!0,550!0,134!1,135!0,30!0,146!0,143!0,259!0,279!0,535!0,536!0,537!0,538!0,539!0,598!0,148!0,149!0,102!0,646!0,147!0,161!0,252!0,270!0,150!0,39!0,199!0,306!0,137!0,475!0,594!0,625!0,152!1,153!0,155!1,157!1,151!0,309!0,156!0,291!0,292!0,84!0,563!0,564!0,565!0,566!0,567!0,600!0,167!0,168!0,169!0,349!0,329!0,170!0,350!0,351!0,352!0,333!0,282!0,171!0,172!0,173!0,328!0,483!0,174!0,175!0,354!0,331!0,332!0,510!0,525!0,509!0,524!0,162!0,163!0,164!0,165!0,166!0,469!0,467!0,103!0,181!0,367!0,249!0,365!0,377!0,366!0,368!0,369!0,375!0,376!0,356!0,357!0,358!0,362!0,380!0,425!0,378!0,379!0,382!0,381!0,185!0,383!0,384!0,186!0,187!0,188!0,189!0,192!0,190!0,191!0,96!0,97!0,98!0,283!0,284!0,105!0,100!0,436!0,353!0,109!0,107!0,473!0,484!0,485!0,497!0,506!0,514!0,609!0,110!0,111!0,112!0,113!0,114!0,118!0,124!0,424!0,122!0,108!0,123!0,32!0,293!0,273!0,434!0,115!0,116!0,99!0,335!0,117!0,42!0,371!0,486!0,513!0,627!0,370!0,119!0,120!0,373!0,128!1,129!1,145!1,144!0,158!0,141!0,160!2,130!2,132!1,133!1,618!1,502!1,608!1,177!0,433!0,95!0,260!0,298!0,280!0,91!0,262!0,593!0,327!0,257!0,265!0,267!0,303!0,234!0,336!0,615!0,612!0,613!0,614!0,254!0,272!0,261!0,87!0,390!0,435!0,499!0,529!0,540!0,546!0,605!0,616!0,626!0,640!0,642!0,643!0,645!0,131!0,302!0,4!0,604!0,452!0,578!0,579!0,580!0,581!0,547!0,648!0,459!0,460!0,461!0,570!0,571!0,572!0,573!0,275!0,86!0,320!0,503!0,504!0,505!0,560!0,548!0,549!0,343!1,344!1,628!0,12!0,121!0,276!0,277!0,601!0,65!0,76!0,305!0,477!0,603!0,637!0,66!0,71!0,81!0,345!0,31!0,480!0,515!0,541!0,589!0,644!0,67!0,420!0,72!0,73!0,74!0,48!0,92!0,561!0,70!0,530!0,479!0,531!0,533!0,534!0,311!0,507!0,508!0,448!0,324!0,346!0,450!0,595!0,325!0,476!0,520!0,527!0,359!0,360!0,361!0,428!0,429!0,551!0,554!0,559!0,555!0,556!0,552!0,553!0,635!0,557!0,636!0,562!0,582!0,617!0,610!0,611!0,631!0,632!0,310!0,314!0,29!0,347!0,449!0,348!0,471!0,478!0,501!0,576!0,596!0,597!0,599!0,312!0,34!0,482!0,481!0,630!0,313!0,318!0,523!0,528!0,619!0,620!0,633!0,634!0,629!0,15!1,263!1,518!0,542!0,543!0,544!0'

--first
set @lendcharind= charindex(',',@StrChain,1)
insert into #TmpChainDec(RawStr) select substring(@StrChain,1,@lendcharind-1)


-- other

DECLARE @cnt INT = 0;

WHILE @cnt < 510
BEGIN
   set @lstcharind=@lendcharind+1
   set @lendcharind= charindex(',',@StrChain, @lstcharind)
   insert into #TmpChainDec(RawStr) select substring(@StrChain,@lstcharind,@lendcharind-@lstcharind)
   SET @cnt = @cnt + 1;
   
END;
-- Last
set @lstcharind=@lendcharind+1
set @lendcharind= charindex('!',@StrChain, @lstcharind)
insert into #TmpChainDec(RawStr) select substring(@StrChain,@lstcharind,@lendcharind-@lstcharind+2)

update #TmpChainDec set IDStr=CONVERT(int, substring(RawStr,1,CHARINDEX('!',Rawstr,1)-1))

select A.*,B.MenuItemName, 
case 
   when substring(RawStr,PATINDEX('%!%',RawStr)+1,2) =1 then 'Read'
   when substring(RawStr,PATINDEX('%!%',RawStr)+1,2) =2 then 'Read And Write'
   else 'No Access'
end
as access 
from #TmpChainDec A
inner join
CAMS_MenuList_View B  on A.IDStr=B.CAMSMenuID


drop table #TmpChainDec



